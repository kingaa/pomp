
R version 3.1.2 (2014-10-31) -- "Pumpkin Helmet"
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(pompExamples)
Loading required package: pomp
Loading required package: subplex
Loading required package: nloptr
> 
> all <- c("SEIR.small","SEIR.big","SEIRS.small","SEIRS.big","SEIRR.small","SEIRR.big","full.small","full.big")
> 
> sapply(all,function(n)eval(bquote(pertussis.sim(.(n))))) -> pt
> 
> names(pt)
[1] "SEIR.small"  "SEIR.big"    "SEIRS.small" "SEIRS.big"   "SEIRR.small"
[6] "SEIRR.big"   "full.small"  "full.big"   
> x <- lapply(pt,as.data.frame)
> 
> print(lapply(x,tail))
$SEIR.small
         time reports     S   E   I     R1 R2 cases W err simpop
1036 19.90385      70 26873 244 409 472429  0   225 0   7 499955
1037 19.92308      69 26810 239 435 472458  0   221 0   7 499942
1038 19.94231      54 26797 244 435 472497  0   208 0   7 499973
1039 19.96154      46 26746 274 417 472542  0   205 0   7 499979
1040 19.98077      53 26709 256 450 472538  0   228 0   7 499953
1041 20.00000      71 26679 273 415 472560  0   183 0   7 499927

$SEIR.big
         time reports      S    E    I      R1 R2 cases W err  simpop
1036 19.90385     520 255547 1703 2917 4739686  0  1470 0   7 4999853
1037 19.92308     484 255784 1759 3003 4739211  0  1489 0   7 4999757
1038 19.94231     406 256081 1856 2995 4738900  0  1444 0   7 4999832
1039 19.96154     533 256320 1869 3129 4738606  0  1597 0   7 4999924
1040 19.98077     425 256551 1879 3164 4738317  0  1545 0   7 4999911
1041 20.00000     412 257106 1639 3151 4738010  0  1495 0   7 4999906

$SEIRS.small
         time reports     S   E   I     R1     R2 cases W err simpop
1036 19.90385      47 80392 539 920 228000 190629   467 0   7 500480
1037 19.92308      41 80392 578 909 227952 190651   431 0   7 500482
1038 19.94231      49 80395 591 914 227879 190690   464 0   7 500469
1039 19.96154      67 80471 575 975 227795 190660   500 0   7 500476
1040 19.98077      42 80516 553 993 227732 190669   513 0   7 500463
1041 20.00000      61 80660 492 986 227653 190677   461 0   7 500468

$SEIRS.big
         time reports      S    E    I      R1      R2 cases W err  simpop
1036 19.90385     489 773965 5409 9193 2299336 1912393  4484 0   7 5000296
1037 19.92308     568 774652 5472 9318 2298462 1912401  4574 0   7 5000305
1038 19.94231     397 775170 5539 9426 2297714 1912390  4671 0   7 5000239
1039 19.96154     411 775614 5740 9491 2297059 1912330  4609 0   7 5000234
1040 19.98077     442 776437 5571 9697 2296283 1912273  4748 0   7 5000261
1041 20.00000     518 778090 4858 9441 2295594 1912196  4335 0   7 5000179

$SEIRR.small
         time reports     S   E    I     R1     R2 cases W err simpop
1036 19.90385      73 64537 864 1441 317687 115760   714 0   7 500289
1037 19.92308      69 64260 896 1502 318088 115525   758 0   7 500271
1038 19.94231      76 63954 981 1543 318494 115282   748 0   7 500254
1039 19.96154      84 63664 965 1638 318953 115037   836 0   7 500257
1040 19.98077      91 63373 992 1670 319485 114723   802 0   7 500243
1041 20.00000      81 63266 861 1646 319863 114604   760 0   7 500240

$SEIRR.big
         time reports      S    E    I      R1      R2 cases W err  simpop
1036 19.90385     481 641670 4792 7924 3195207 1153657  3925 0   7 5003250
1037 19.92308     379 642044 5038 8097 3193839 1154198  4018 0   7 5003216
1038 19.94231     541 642462 5084 8425 3192769 1154480  4217 0   7 5003220
1039 19.96154     577 642681 5221 8605 3192041 1154729  4331 0   7 5003277
1040 19.98077     437 643030 5160 8849 3191258 1155014  4418 0   7 5003311
1041 20.00000     400 644214 4588 8562 3189940 1155983  3884 0   7 5003287

$full.small
         time reports     S   E   I     R1     R2 cases         W err simpop
1036 19.90385      38 60812 492 892 330814 107242   437 -9.164189   7 500252
1037 19.92308      35 60904 514 881 330659 107326   413 -9.153313   7 500284
1038 19.94231      44 60988 464 873 330490 107453   420 -9.279501   7 500268
1039 19.96154      46 61032 517 876 330295 107543   398 -9.092366   7 500263
1040 19.98077      39 61122 504 845 330138 107631   403 -9.103926   7 500240
1041 20.00000      43 61258 474 820 329898 107806   384 -8.973250   7 500256

$full.big
         time reports      S    E    I      R1      R2 cases         W err
1036 19.90385     319 624607 4552 7566 3278019 1088429  3664 -4.654307   7
1037 19.92308     372 625824 4363 7590 3275577 1089789  3677 -4.795999   7
1038 19.94231     348 626800 4490 7621 3273350 1090834  3689 -4.774106   7
1039 19.96154     377 628074 4334 7672 3271128 1091904  3713 -4.848567   7
1040 19.98077     331 629454 4185 7381 3268762 1093266  3431 -5.014912   7
1041 20.00000     367 631218 3705 7153 3265743 1095129  3306 -4.966009   7
      simpop
1036 5003173
1037 5003143
1038 5003095
1039 5003112
1040 5003048
1041 5002948

> 
> x <- simulate(pertussis.sim(full.big),seed=395885L,as.data.frame=TRUE)
> tail(x)
         time reports      S    E    I      R1      R2 cases          W err
1036 19.90385     432 662434 5677 9458 3201351 1118149  4831 -0.4801610   7
1037 19.92308     524 662819 5615 9625 3200616 1118455  4737 -0.6165661   7
1038 19.94231     396 662918 5888 9754 3200171 1118414  4831 -0.5954462   7
1039 19.96154     515 663272 5698 9925 3199550 1118678  4928 -0.7923733   7
1040 19.98077     504 663479 5812 9991 3198989 1118914  4782 -0.8369185   7
1041 20.00000     529 664560 5030 9867 3197787 1119969  4609 -0.8803061   7
      simpop sim
1036 4997069   1
1037 4997130   1
1038 4997145   1
1039 4997123   1
1040 4997185   1
1041 4997213   1
> 
> y <- trajectory(pertussis.sim(SEIRS.small),as.data.frame=TRUE)
> tail(y)
            S        E         I       R1       R2    cases W err simpop
1036 81409.73 558.4599  942.3100 227353.0 189736.5 487.2963 0   0  5e+05
1037 81420.36 573.0107  965.5155 227305.3 189735.8 500.4770 0   0  5e+05
1038 81418.14 587.5604  989.6877 227269.6 189735.0 513.3168 0   0  5e+05
1039 81402.73 602.3328 1014.5493 227246.2 189734.2 526.2802 0   0  5e+05
1040 81415.22 580.7639 1035.4780 227235.2 189733.4 534.7187 0   0  5e+05
1041 81532.40 510.2405 1002.6699 227222.2 189732.5 478.9785 0   0  5e+05
         time traj
1036 19.90385    1
1037 19.92308    1
1038 19.94231    1
1039 19.96154    1
1040 19.98077    1
1041 20.00000    1
> 
> system.time(pf <- pfilter(pertussis.sim(full.small),seed=3445886L,Np=1000))
   user  system elapsed 
 18.793   0.000  18.864 
> logLik(pf)
[1] -3829.33
> 
> pttest <- function (po, digits = 15) {
+   identical(
+             signif(coef(po),digits=digits),
+             signif(partrans(po,partrans(po,coef(po),dir='inv'),dir='for'),digits=digits)
+             )
+ }
> 
> stopifnot(all(sapply(pt,pttest)))
> 
> pttest <- function (po, digits = 15) {
+   identical(
+             signif(coef(po,trans=T),digits=digits),
+             signif(partrans(po,partrans(po,coef(po,trans=T),dir='f'),dir='inv'),digits=digits)
+             )
+ }
> 
> stopifnot(all(sapply(pt,pttest)))
> 
> proc.time()
   user  system elapsed 
 19.533   0.040  19.671 
